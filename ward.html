<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ward Management - Nursing Note</title>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <link rel="stylesheet" href="style.css"> 

    <style>
        /* CSS ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ */
        .ward-header {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: var(--shadow);
            margin-bottom: 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: center;
            justify-content: space-between;
        }
        
        .ward-controls {
            display: flex;
            gap: 10px;
            flex-grow: 1;
        }

        .ward-select {
            padding: 10px;
            border: 2px solid var(--primary);
            border-radius: 8px;
            font-size: 1rem;
            color: var(--primary-dark);
            font-weight: bold;
            min-width: 200px;
            cursor: pointer;
        }

        .search-box {
            flex-grow: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
        }

        .patient-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .patient-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: var(--shadow);
            border-left: 5px solid #ddd;
            cursor: pointer;
            transition: 0.2s;
            position: relative;
        }

        .patient-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border-left-color: var(--primary);
        }

        .patient-card h3 { margin: 0 0 5px 0; color: #333; }
        .patient-card .hn { color: #777; font-size: 0.9rem; margin-bottom: 10px; }
        .patient-card .info { font-size: 0.9rem; color: #555; display: flex; justify-content: space-between; margin-top: 5px;}
        .patient-card .ward-tag {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 0.75rem;
            background: #e3f2fd;
            color: #1565c0;
            padding: 3px 8px;
            border-radius: 10px;
        }

        .btn-del {
            background: #ffebee; color: #c62828; border: none;
            padding: 5px 10px; border-radius: 4px; font-size: 0.8rem;
            margin-top: 10px; cursor: pointer;
        }
        .btn-del:hover { background: #ffcdd2; }

        /* Modal Styles */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); justify-content: center; align-items: center; z-index: 1000; }
        .modal-content { background: white; padding: 25px; border-radius: 12px; width: 90%; max-width: 500px; }
        .modal-header { font-weight: bold; font-size: 1.2rem; margin-bottom: 15px; color: var(--primary); }
        .form-row { margin-bottom: 15px; }
        .form-row label { display: block; margin-bottom: 5px; font-weight: 500; }
        .form-row input, .form-row select { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 6px; }
        .modal-actions { display: flex; justify-content: flex-end; gap: 10px; margin-top: 20px; }
    </style>
</head>
<body>

    <nav class="navbar">
        <div style="font-weight:bold; font-size:1.1rem;">
            <i class="fas fa-hospital-user"></i> ‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢ (Ward Manager)
        </div>
        <div style="font-size:0.9rem;">
            <i class="fas fa-user-nurse"></i> <span id="userDisplay">‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•</span>
        </div>
    </nav>

    <div class="container" style="max-width: 1200px;">
        
        <div class="ward-header">
            <div class="ward-controls">
                <select id="wardSelector" class="ward-select" onchange="filterPatients()">
                    <option value="ALL">üè• ‡∏ó‡∏∏‡∏Å‡∏ß‡∏≠‡∏£‡πå‡∏î (All Wards)</option>
                    <option value="Med1">‡∏≠‡∏≤‡∏¢‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°‡∏ä‡∏≤‡∏¢ 1</option>
                    <option value="Med2">‡∏≠‡∏≤‡∏¢‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°‡∏´‡∏ç‡∏¥‡∏á 2</option>
                    <option value="Surg1">‡∏®‡∏±‡∏•‡∏¢‡∏Å‡∏£‡∏£‡∏°‡∏ä‡∏≤‡∏¢</option>
                    <option value="Surg2">‡∏®‡∏±‡∏•‡∏¢‡∏Å‡∏£‡∏£‡∏°‡∏´‡∏ç‡∏¥‡∏á</option>
                    <option value="Ortho">‡∏Å‡∏£‡∏∞‡∏î‡∏π‡∏Å‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠</option>
                    <option value="ICU">ICU</option>
                    <option value="ER">‡∏´‡πâ‡∏≠‡∏á‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô</option>
                </select>

                <input type="text" id="searchInput" class="search-box" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠ ‡∏´‡∏£‡∏∑‡∏≠ HN..." onkeyup="filterPatients()">
            </div>
            
            <button class="btn btn-primary" onclick="openModal()">
                <i class="fas fa-user-plus"></i> ‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢‡πÉ‡∏´‡∏°‡πà (Admit)
            </button>
        </div>

        <div id="patientGrid" class="patient-grid">
            </div>

    </div>

    <div id="addModal" class="modal">
        <div class="modal-content">
            <div class="modal-header"><i class="fas fa-procedures"></i> ‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢‡πÉ‡∏´‡∏°‡πà (New Admit)</div>
            
            <div class="form-row" style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                <div>
                    <label>HN:</label>
                    <input type="text" id="newHN" placeholder="‡πÄ‡∏ä‡πà‡∏ô 66-123456">
                </div>
                <div>
                    <label>AN:</label>
                    <input type="text" id="newAN" placeholder="‡πÄ‡∏ä‡πà‡∏ô 66-9999">
                </div>
            </div>
            
            <div class="form-row">
                <label>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•:</label>
                <input type="text" id="newName" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ô‡∏≤‡∏¢‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡πÉ‡∏à‡∏î‡∏µ">
            </div>

            <div class="form-row">
                <label>‡∏ß‡∏≠‡∏£‡πå‡∏î (Ward):</label>
                <select id="newWard">
                    <option value="Med1">‡∏≠‡∏≤‡∏¢‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°‡∏ä‡∏≤‡∏¢ 1</option>
                    <option value="Med2">‡∏≠‡∏≤‡∏¢‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°‡∏´‡∏ç‡∏¥‡∏á 2</option>
                    <option value="Surg1">‡∏®‡∏±‡∏•‡∏¢‡∏Å‡∏£‡∏£‡∏°‡∏ä‡∏≤‡∏¢</option>
                    <option value="Surg2">‡∏®‡∏±‡∏•‡∏¢‡∏Å‡∏£‡∏£‡∏°‡∏´‡∏ç‡∏¥‡∏á</option>
                    <option value="Ortho">‡∏Å‡∏£‡∏∞‡∏î‡∏π‡∏Å‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠</option>
                    <option value="ICU">ICU</option>
                    <option value="ER">‡∏´‡πâ‡∏≠‡∏á‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô</option>
                </select>
            </div>

            <div class="form-row">
                <label>‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡∏ô‡∏¥‡∏à‡∏â‡∏±‡∏¢‡πÇ‡∏£‡∏Ñ (Diagnosis):</label>
                <input type="text" id="newDx" placeholder="‡πÄ‡∏ä‡πà‡∏ô Pneumonia, CA Lung">
            </div>

            <div class="form-row" style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                 <div>
                    <label>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó (Type):</label>
                    <select id="newType">
                        <option value="1">Type 1 (‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡πÑ‡∏î‡πâ)</option>
                        <option value="2">Type 2 (‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏ö‡πâ‡∏≤‡∏á)</option>
                        <option value="3">Type 3 (‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏Å‡∏∑‡∏≠‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î)</option>
                        <option value="4">Type 4 (‡∏ß‡∏¥‡∏Å‡∏§‡∏ï/‡∏ï‡∏¥‡∏î‡πÄ‡∏ï‡∏µ‡∏¢‡∏á)</option>
                        <option value="5">Type 5 (Palliative)</option>
                    </select>
                 </div>
                 <div>
                    <label>‡πÄ‡∏ï‡∏µ‡∏¢‡∏á:</label>
                    <input type="text" id="newBed" placeholder="‡πÄ‡∏ä‡πà‡∏ô 12">
                 </div>
            </div>

            <div class="modal-actions">
                <button class="btn btn-reset" onclick="closeModal()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                <button class="btn btn-primary" onclick="savePatient()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
            </div>
        </div>
    </div>

    <script>
        // 1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Login (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
        const currentUser = sessionStorage.getItem('currentUser') || "‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•";
        document.getElementById('userDisplay').innerText = currentUser;

        // 2. ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢ (‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ)
        let patients = JSON.parse(localStorage.getItem('patients')) || [
            { hn: '66-00123', an: '66-1111', name: '‡∏ô‡∏≤‡∏¢‡∏°‡∏µ‡∏ä‡∏±‡∏¢ ‡∏£‡∏±‡∏Å‡∏î‡∏µ', ward: 'Med1', dx: 'Pneumonia', type: '3', bed: '01', admit: '2025-01-10' },
            { hn: '66-00124', an: '66-1112', name: '‡∏ô‡∏≤‡∏á‡∏™‡∏°‡∏®‡∏£‡∏µ ‡∏™‡∏µ‡∏™‡∏ß‡∏¢', ward: 'Surg1', dx: 'Post-op Appendectomy', type: '2', bed: '05', admit: '2025-01-12' },
            { hn: '66-00125', an: '66-1113', name: '‡∏•‡∏∏‡∏á‡∏ö‡∏∏‡∏ç ‡∏°‡∏µ‡∏Å‡∏£‡∏£‡∏°', ward: 'Ortho', dx: 'Fracture Femur', type: '4', bed: '02', admit: '2025-01-15' }
        ];

        // ‡πÇ‡∏´‡∏•‡∏î‡∏ß‡∏≠‡∏£‡πå‡∏î‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ß‡πâ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
        const savedWard = localStorage.getItem('selectedWard') || 'ALL';
        document.getElementById('wardSelector').value = savedWard;

        // 3. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
        function filterPatients() {
            const ward = document.getElementById('wardSelector').value;
            const search = document.getElementById('searchInput').value.toLowerCase();
            localStorage.setItem('selectedWard', ward); // ‡∏à‡∏≥‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å

            const grid = document.getElementById('patientGrid');
            grid.innerHTML = '';

            const filtered = patients.filter(p => {
                const matchWard = (ward === 'ALL') || (p.ward === ward);
                const matchSearch = p.name.toLowerCase().includes(search) || p.hn.includes(search);
                return matchWard && matchSearch;
            });

            if(filtered.length === 0) {
                grid.innerHTML = '<div style="grid-column:1/-1; text-align:center; color:#999; margin-top:50px;">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢</div>';
                return;
            }

            filtered.forEach((p, index) => {
                const card = document.createElement('div');
                card.className = 'patient-card';
                // ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏Å‡∏≤‡∏£‡πå‡∏î ‡πÉ‡∏´‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢‡∏Ñ‡∏ô‡∏ô‡∏µ‡πâ‡πÅ‡∏•‡πâ‡∏ß‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
                card.onclick = (e) => {
                    if(!e.target.classList.contains('btn-del')) selectPatient(p);
                };

                let typeColor = '#ddd';
                if(p.type === '3') typeColor = '#ff9800';
                if(p.type === '4') typeColor = '#f44336';
                if(p.type === '5') typeColor = '#9c27b0';

                card.innerHTML = `
                    <span class="ward-tag">${p.ward} | ‡πÄ‡∏ï‡∏µ‡∏¢‡∏á ${p.bed || '-'}</span>
                    <div style="width:10px; height:10px; background:${typeColor}; border-radius:50%; display:inline-block; margin-right:5px;"></div>
                    <h3>${p.name}</h3>
                    <div class="hn">HN: ${p.hn} | AN: ${p.an}</div>
                    <div style="font-size:0.9rem; color:#00695c; margin-bottom:10px;">Dx: ${p.dx}</div>
                    <div class="info">
                        <span>Admit: ${p.admit}</span>
                        <span>Type: ${p.type}</span>
                    </div>
                    <button class="btn-del" onclick="deletePatient('${p.hn}')"><i class="fas fa-trash"></i> ‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢/‡∏•‡∏ö</button>
                `;
                grid.appendChild(card);
            });
        }

        // 4. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢ (‡∏´‡∏±‡∏ß‡πÉ‡∏à‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç)
        function selectPatient(patient) {
            // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏ô‡πÑ‡∏Ç‡πâ‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏•‡∏á LocalStorage
            localStorage.setItem('patientProfile', JSON.stringify(patient));
            localStorage.setItem('currentHN', patient.hn); // ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏¢‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å Note
            
            // ‡∏Å‡∏£‡∏∞‡πÇ‡∏î‡∏î‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å (index.html)
            window.location.href = 'index.html';
        }

        // 5. ‡∏£‡∏∞‡∏ö‡∏ö Modal ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢
        function openModal() { 
            // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Default ‡∏ß‡∏≠‡∏£‡πå‡∏î‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏¢‡∏π‡πà
            const currentWard = document.getElementById('wardSelector').value;
            if(currentWard !== 'ALL') document.getElementById('newWard').value = currentWard;
            document.getElementById('addModal').style.display = 'flex'; 
        }
        function closeModal() { document.getElementById('addModal').style.display = 'none'; }
        
        function savePatient() {
            const newP = {
                hn: document.getElementById('newHN').value,
                an: document.getElementById('newAN').value,
                name: document.getElementById('newName').value,
                ward: document.getElementById('newWard').value,
                dx: document.getElementById('newDx').value,
                type: document.getElementById('newType').value,
                bed: document.getElementById('newBed').value,
                admit: new Date().toISOString().slice(0,10)
            };

            if(!newP.hn || !newP.name) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å HN ‡πÅ‡∏•‡∏∞‡∏ä‡∏∑‡πà‡∏≠");

            patients.push(newP);
            localStorage.setItem('patients', JSON.stringify(patients));
            
            closeModal();
            filterPatients(); // ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠
            
            // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏ü‡∏≠‡∏£‡πå‡∏°
            document.getElementById('newHN').value = '';
            document.getElementById('newAN').value = '';
            document.getElementById('newName').value = '';
        }

        function deletePatient(hn) {
            if(confirm("‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö/‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢‡∏£‡∏≤‡∏¢‡∏ô‡∏µ‡πâ?")) {
                patients = patients.filter(p => p.hn !== hn);
                localStorage.setItem('patients', JSON.stringify(patients));
                filterPatients();
            }
        }

        // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
        filterPatients();

    </script>
</body>
</html>
