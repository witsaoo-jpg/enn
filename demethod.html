<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Discharge Planning (D-M-E-T-H-O-D)</title>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css"> 
    
    <style>
        /* --- Layout & Grid --- */
        body { background-color: #f0f2f5; }
        
        .layout-container {
            display: grid;
            grid-template-columns: 320px 1fr; /* ‡∏ã‡πâ‡∏≤‡∏¢ 320px, ‡∏Ç‡∏ß‡∏≤‡πÄ‡∏ï‡πá‡∏°‡∏à‡∏≠ */
            gap: 25px;
            margin-top: 20px;
            align-items: start;
        }

        /* --- Header Card --- */
        .patient-header-card {
            background: linear-gradient(135deg, var(--primary) 0%, #004d40 100%);
            color: white;
            padding: 20px 25px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .ph-info h2 { margin: 0; font-size: 1.5rem; display: flex; align-items: center; gap: 10px; }
        .ph-meta { margin-top: 5px; font-size: 1rem; opacity: 0.9; }
        .ph-meta span { margin-right: 15px; background: rgba(255,255,255,0.2); padding: 3px 10px; border-radius: 15px; font-size: 0.9rem; }

        /* --- Sidebar (Templates) --- */
        .sidebar-card {
            background: white;
            border-radius: 12px;
            box-shadow: var(--shadow);
            padding: 20px;
            height: calc(100vh - 180px); /* ‡πÄ‡∏ï‡πá‡∏°‡∏à‡∏≠‡∏û‡∏≠‡∏î‡∏µ */
            display: flex;
            flex-direction: column;
            border: 1px solid #e0e0e0;
        }
        
        .sidebar-title {
            font-size: 1.1rem; font-weight: bold; color: var(--primary);
            margin-bottom: 15px; border-bottom: 2px solid #f0f0f0; padding-bottom: 10px;
        }

        .search-box {
            width: 100%; padding: 10px 15px; border: 1px solid #ddd;
            border-radius: 25px; background: #f9f9f9; outline: none; transition: 0.3s;
            margin-bottom: 15px;
        }
        .search-box:focus { border-color: var(--primary); background: white; box-shadow: 0 0 5px rgba(0,105,92,0.1); }

        #templateList { flex-grow: 1; overflow-y: auto; padding-right: 5px; }

        .template-item {
            padding: 12px 15px;
            margin-bottom: 8px;
            background: #fff;
            border: 1px solid #eee;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            overflow: hidden;
        }
        .template-item:hover {
            border-color: var(--primary);
            background: #e0f2f1;
            transform: translateX(3px);
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .template-item::before {
            content: ''; position: absolute; left: 0; top: 0; bottom: 0; width: 4px;
            background: var(--primary); opacity: 0; transition: 0.2s;
        }
        .template-item:hover::before { opacity: 1; }
        
        .template-item strong { display: block; color: #333; font-size: 0.95rem; }
        .template-item small { color: #888; font-size: 0.8rem; }

        /* --- Main Form (Editor) --- */
        .form-card {
            background: white;
            border-radius: 12px;
            box-shadow: var(--shadow);
            padding: 30px;
            min-height: calc(100vh - 180px);
            position: relative;
        }

        /* Action Buttons Toolbar */
        .action-toolbar {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
            position: sticky;
            top: 0;
            background: white;
            z-index: 10;
        }

        .btn-action {
            padding: 8px 15px;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: 0.2s;
        }
        .btn-save { background: #2e7d32; color: white; }
        .btn-save:hover { background: #1b5e20; box-shadow: 0 4px 10px rgba(46, 125, 50, 0.3); }
        
        .btn-clear { background: #ffebee; color: #c62828; }
        .btn-clear:hover { background: #ffcdd2; }

        .btn-print { background: #0277bd; color: white; }
        .btn-print:hover { background: #01579b; box-shadow: 0 4px 10px rgba(2, 119, 189, 0.3); }

        /* Input Groups */
        .dm-group { margin-bottom: 20px; }
        .dm-label {
            display: flex; align-items: center; gap: 8px;
            font-weight: bold; font-size: 1.05rem; color: #37474f;
            margin-bottom: 8px;
        }
        .dm-label i { color: var(--accent); width: 20px; text-align: center; }
        
        .dm-textarea {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #cfd8dc;
            border-radius: 8px;
            font-family: 'Sarabun', sans-serif;
            font-size: 1rem;
            line-height: 1.6;
            min-height: 85px;
            resize: vertical;
            transition: 0.2s;
            background: #fafafa;
        }
        .dm-textarea:focus {
            background: white;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(0, 105, 92, 0.1);
            outline: none;
        }

        /* --- Print Styles --- */
        .print-only-header { display: none; }
        @media print {
            .navbar, .sidebar-card, .action-toolbar, .no-print { display: none !important; }
            body { background: white; margin: 0; padding: 0; }
            .container { max-width: 100%; width: 100%; margin: 0; padding: 0; }
            .layout-container { display: block; margin: 0; }
            .patient-header-card { display: none; }
            
            .print-only-header { display: block; text-align: center; margin-bottom: 20px; border-bottom: 2px solid #333; padding-bottom: 10px; }
            .form-card { box-shadow: none; padding: 0; border: none; }
            
            .dm-textarea { 
                border: none; resize: none; min-height: auto; padding: 0; 
                margin-bottom: 5px; font-size: 12pt; height: auto; background: none; 
            }
            .dm-label { 
                margin-bottom: 2px; font-size: 12pt; color: black; 
                text-decoration: underline; 
            }
            .dm-label i { display: none; } /* ‡∏ã‡πà‡∏≠‡∏ô‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡∏ï‡∏≠‡∏ô‡∏õ‡∏£‡∏¥‡πâ‡∏ô */
            .dm-group { break-inside: avoid; margin-bottom: 10px; page-break-inside: avoid; }
            
            #printContent { width: 100%; }
        }
    </style>
</head>
<body>

    <nav class="navbar">
        <div style="font-weight:bold; font-size:1.1rem;">
            <i class="fas fa-home"></i> Discharge Planning
        </div>
        <div style="display:flex; gap:10px;">
            <button onclick="window.location.href='index.html'" class="btn" style="background:rgba(255,255,255,0.2); color:white;">
                <i class="fas fa-arrow-left"></i> ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
            </button>
        </div>
    </nav>

    <div class="container" style="max-width: 98%;">
        
        <div class="patient-header-card">
            <div class="ph-info">
                <h2><i class="fas fa-user-injured"></i> <span id="ptName">...</span></h2>
                <div class="ph-meta">
                    <span><i class="fas fa-id-card"></i> HN: <span id="ptHN">-</span></span>
                    <span><i class="fas fa-procedures"></i> AN: <span id="ptAN">-</span></span>
                    <span><i class="fas fa-clinic-medical"></i> Ward: <span id="ptWard">-</span></span>
                </div>
            </div>
            </div>

        <div class="layout-container">
            
            <div class="sidebar-card">
                <div class="sidebar-title"><i class="fas fa-book-medical"></i> ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÇ‡∏£‡∏Ñ (Templates)</div>
                <input type="text" id="searchTemplate" class="search-box" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏£‡∏Ñ..." onkeyup="renderTemplates()">
                
                <div id="templateList">
                    </div>
                
                <div style="margin-top:auto; font-size:0.8rem; color:#999; text-align:center; padding-top:10px;">
                    *‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏£‡∏Ñ‡πÑ‡∏î‡πâ‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå Code
                </div>
            </div>

            <div id="printContent">
                <div class="print-only-header">
                    <h2>‡πÉ‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢ (Discharge Planning)</h2>
                    <p style="font-size:14pt;"><b>‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•:</b> <span id="pNamePrint"></span> <b>HN:</b> <span id="pHNPrint"></span> <b>Ward:</b> <span id="pWardPrint"></span></p>
                </div>

                <div class="form-card">
                    
                    <div class="action-toolbar">
                        <button class="btn-action btn-clear" onclick="clearForm()">
                            <i class="fas fa-eraser"></i> ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                        </button>
                        <button class="btn-action btn-save" onclick="saveDischargeNote()">
                            <i class="fas fa-save"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢
                        </button>
                        <button class="btn-action btn-print" onclick="window.print()">
                            <i class="fas fa-print"></i> ‡∏û‡∏¥‡∏°‡∏û‡πå‡πÉ‡∏ö D-M-E-T
                        </button>
                    </div>

                    <div class="dm-group">
                        <div class="dm-label"><i class="fas fa-stethoscope"></i> D - Diagnosis (‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡∏ô‡∏¥‡∏à‡∏â‡∏±‡∏¢‡πÇ‡∏£‡∏Ñ)</div>
                        <textarea id="inp_d" class="dm-textarea"></textarea>
                    </div>
                    
                    <div class="dm-group">
                        <div class="dm-label"><i class="fas fa-pills"></i> M - Medicine (‡∏¢‡∏≤)</div>
                        <textarea id="inp_m" class="dm-textarea"></textarea>
                    </div>
                    
                    <div class="dm-group">
                        <div class="dm-label"><i class="fas fa-home"></i> E - Environment (‡∏™‡∏¥‡πà‡∏á‡πÅ‡∏ß‡∏î‡∏•‡πâ‡∏≠‡∏°)</div>
                        <textarea id="inp_e" class="dm-textarea"></textarea>
                    </div>
                    
                    <div class="dm-group">
                        <div class="dm-label"><i class="fas fa-crutch"></i> T - Treatment (‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏Å‡∏©‡∏≤/‡∏î‡∏π‡πÅ‡∏•‡∏ï‡∏ô‡πÄ‡∏≠‡∏á)</div>
                        <textarea id="inp_t" class="dm-textarea"></textarea>
                    </div>
                    
                    <div class="dm-group">
                        <div class="dm-label"><i class="fas fa-heartbeat"></i> H - Health (‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û/‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï)</div>
                        <textarea id="inp_h" class="dm-textarea"></textarea>
                    </div>
                    
                    <div class="dm-group">
                        <div class="dm-label"><i class="fas fa-calendar-alt"></i> O - Outpatient (‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏î‡∏ï‡∏£‡∏ß‡∏à)</div>
                        <textarea id="inp_o" class="dm-textarea"></textarea>
                    </div>
                    
                    <div class="dm-group">
                        <div class="dm-label"><i class="fas fa-utensils"></i> D - Diet (‡∏≠‡∏≤‡∏´‡∏≤‡∏£)</div>
                        <textarea id="inp_d2" class="dm-textarea"></textarea>
                    </div>
                    
                    <div class="print-only-header" style="border:none; margin-top:50px; text-align:right;">
                        <p>‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏ú‡∏π‡πâ‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢ ...........................................................</p>
                        <p>(...........................................................)</p>
                        <p>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ........................................</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

<script>
    // -------------------------------------------------------------------
    // 1. ‡∏™‡πà‡∏ß‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Template ‡πÇ‡∏£‡∏Ñ (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÇ‡∏£‡∏Ñ)
    // -------------------------------------------------------------------
    const dischargeTemplates = [
        {
            id: 'SURG01', title: '‡πÑ‡∏™‡πâ‡∏ï‡∏¥‡πà‡∏á‡∏≠‡∏±‡∏Å‡πÄ‡∏™‡∏ö (Post-op Appendectomy)',
            d: '‡πÇ‡∏£‡∏Ñ‡πÑ‡∏™‡πâ‡∏ï‡∏¥‡πà‡∏á‡∏≠‡∏±‡∏Å‡πÄ‡∏™‡∏ö‡πÄ‡∏â‡∏µ‡∏¢‡∏ö‡∏û‡∏•‡∏±‡∏ô (Acute Appendicitis) ‡πÅ‡∏•‡∏∞‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏Å‡∏©‡∏≤‡πÇ‡∏î‡∏¢‡∏Å‡∏≤‡∏£‡∏ú‡πà‡∏≤‡∏ï‡∏±‡∏î‡πÄ‡∏≠‡∏≤‡πÑ‡∏™‡πâ‡∏ï‡∏¥‡πà‡∏á‡∏≠‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß',
            m: '1. ‡∏¢‡∏≤‡πÅ‡∏Å‡πâ‡∏õ‡∏ß‡∏î (Paracetamol) ‡∏ó‡∏≤‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏õ‡∏ß‡∏î ‡∏ó‡∏∏‡∏Å 4-6 ‡∏ä‡∏°.\n2. ‡∏¢‡∏≤‡∏Ü‡πà‡∏≤‡πÄ‡∏ä‡∏∑‡πâ‡∏≠ (Antibiotics) ‡∏ó‡∏≤‡∏ô‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ô‡∏à‡∏ô‡∏´‡∏°‡∏î\n3. ‡∏¢‡∏≤‡∏£‡∏∞‡∏ö‡∏≤‡∏¢ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ) ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏ó‡πâ‡∏≠‡∏á‡∏ú‡∏π‡∏Å',
            e: '‡∏à‡∏±‡∏î‡∏´‡πâ‡∏≠‡∏á‡∏ô‡∏≠‡∏ô‡πÉ‡∏´‡πâ‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡∏ñ‡πà‡∏≤‡∏¢‡πÄ‡∏ó ‡∏™‡∏∞‡∏≠‡∏≤‡∏î ‡∏≠‡∏¢‡∏π‡πà‡∏ä‡∏±‡πâ‡∏ô‡∏•‡πà‡∏≤‡∏á‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á 3 ‡∏ß‡∏±‡∏ô‡πÅ‡∏£‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô‡∏•‡∏á‡∏ö‡∏±‡∏ô‡πÑ‡∏î',
            t: '1. ‡∏´‡πâ‡∏≤‡∏°‡πÅ‡∏ú‡∏•‡πÇ‡∏î‡∏ô‡∏ô‡πâ‡∏≥ 7 ‡∏ß‡∏±‡∏ô (‡∏´‡∏£‡∏∑‡∏≠‡∏à‡∏ô‡∏Å‡∏ß‡πà‡∏≤‡∏à‡∏∞‡∏ï‡∏±‡∏î‡πÑ‡∏´‡∏°)\n2. ‡∏´‡πâ‡∏≤‡∏°‡∏¢‡∏Å‡∏Ç‡∏≠‡∏á‡∏´‡∏ô‡∏±‡∏Å > 5 ‡∏Å‡∏Å. ‡∏ô‡∏≤‡∏ô 1 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô\n3. ‡∏•‡∏∏‡∏Å‡πÄ‡∏î‡∏¥‡∏ô‡∏ö‡πà‡∏≠‡∏¢‡πÜ ‡πÅ‡∏ï‡πà‡∏ä‡πâ‡∏≤‡πÜ ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏û‡∏±‡∏á‡∏ú‡∏∑‡∏î',
            h: '‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏≠‡∏≤‡∏Å‡∏≤‡∏£: ‡πÑ‡∏Ç‡πâ‡∏™‡∏π‡∏á, ‡πÅ‡∏ú‡∏•‡∏ö‡∏ß‡∏°‡πÅ‡∏î‡∏á‡∏£‡πâ‡∏≠‡∏ô ‡∏°‡∏µ‡∏´‡∏ô‡∏≠‡∏á, ‡∏õ‡∏ß‡∏î‡∏ó‡πâ‡∏≠‡∏á‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á, ‡∏≠‡∏≤‡πÄ‡∏à‡∏µ‡∏¢‡∏ô‡∏°‡∏≤‡∏Å ‡πÉ‡∏´‡πâ‡∏£‡∏µ‡∏ö‡∏°‡∏≤ ‡∏£‡∏û. ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ',
            o: '‡∏ô‡∏±‡∏î‡∏î‡∏π‡πÅ‡∏ú‡∏•/‡∏ï‡∏±‡∏î‡πÑ‡∏´‡∏° ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ..................... ‡πÄ‡∏ß‡∏•‡∏≤ ........... ‡∏ó‡∏µ‡πà‡∏´‡πâ‡∏≠‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏®‡∏±‡∏•‡∏¢‡∏Å‡∏£‡∏£‡∏° (OPD Surg)',
            d2: '‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏≠‡πà‡∏≠‡∏ô ‡∏¢‡πà‡∏≠‡∏¢‡∏á‡πà‡∏≤‡∏¢ (‡∏Ç‡πâ‡∏≤‡∏ß‡∏ï‡πâ‡∏°/‡πÇ‡∏à‡πä‡∏Å) ‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡πÅ‡∏£‡∏Å, ‡πÄ‡∏ô‡πâ‡∏ô‡∏ú‡∏±‡∏Å‡∏ú‡∏•‡πÑ‡∏°‡πâ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏ó‡πâ‡∏≠‡∏á‡∏ú‡∏π‡∏Å, ‡∏î‡∏∑‡πà‡∏°‡∏ô‡πâ‡∏≥‡∏™‡∏∞‡∏≠‡∏≤‡∏î‡∏°‡∏≤‡∏Å‡πÜ'
        },
        {
            id: 'MED01', title: '‡∏õ‡∏≠‡∏î‡∏≠‡∏±‡∏Å‡πÄ‡∏™‡∏ö (Pneumonia)',
            d: '‡πÇ‡∏£‡∏Ñ‡∏õ‡∏≠‡∏î‡∏≠‡∏±‡∏Å‡πÄ‡∏™‡∏ö (Pneumonia) ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏à‡∏ô‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏î‡∏µ‡∏Ç‡∏∂‡πâ‡∏ô',
            m: '1. ‡∏¢‡∏≤‡∏õ‡∏è‡∏¥‡∏ä‡∏µ‡∏ß‡∏ô‡∏∞ (Antibiotics) ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏°‡∏≤‡∏Å ‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≤‡∏ô‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ï‡∏≤‡∏°‡πÅ‡∏û‡∏ó‡∏¢‡πå‡∏™‡∏±‡πà‡∏á ‡∏´‡πâ‡∏≤‡∏°‡∏´‡∏¢‡∏∏‡∏î‡∏¢‡∏≤‡πÄ‡∏≠‡∏á\n2. ‡∏¢‡∏≤‡∏•‡∏∞‡∏•‡∏≤‡∏¢‡πÄ‡∏™‡∏°‡∏´‡∏∞/‡πÅ‡∏Å‡πâ‡πÑ‡∏≠ ‡∏à‡∏¥‡∏ö‡∏ô‡πâ‡∏≥‡∏≠‡∏∏‡πà‡∏ô‡∏ö‡πà‡∏≠‡∏¢‡πÜ',
            e: '‡∏´‡∏•‡∏µ‡∏Å‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á‡∏Ñ‡∏ß‡∏±‡∏ô‡∏ö‡∏∏‡∏´‡∏£‡∏µ‡πà ‡∏ù‡∏∏‡πà‡∏ô‡∏•‡∏∞‡∏≠‡∏≠‡∏á ‡πÅ‡∏•‡∏∞‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡πÄ‡∏¢‡πá‡∏ô‡∏à‡∏±‡∏î ‡∏à‡∏±‡∏î‡∏´‡πâ‡∏≠‡∏á‡πÉ‡∏´‡πâ‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡∏ñ‡πà‡∏≤‡∏¢‡πÄ‡∏ó',
            t: '1. ‡∏ù‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏´‡∏≤‡∏¢‡πÉ‡∏à‡∏•‡∏∂‡∏Å‡πÜ (Deep breathing) ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏õ‡∏≠‡∏î\n2. ‡∏û‡∏±‡∏Å‡∏ú‡πà‡∏≠‡∏ô‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠\n3. ‡πÉ‡∏™‡πà‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏≤‡∏Å‡∏≠‡∏ô‡∏≤‡∏°‡∏±‡∏¢‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏ä‡∏∏‡∏°‡∏ä‡∏ô',
            h: '‡∏´‡∏≤‡∏Å‡∏°‡∏µ‡πÑ‡∏Ç‡πâ‡∏™‡∏π‡∏á‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤ ‡∏´‡∏≠‡∏ö‡πÄ‡∏´‡∏ô‡∏∑‡πà‡∏≠‡∏¢ ‡πÑ‡∏≠‡∏°‡∏µ‡πÄ‡∏™‡∏°‡∏´‡∏∞‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏µ (‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß/‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á‡∏Ç‡πâ‡∏ô) ‡πÄ‡∏à‡πá‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏≠‡∏Å ‡πÉ‡∏´‡πâ‡∏£‡∏µ‡∏ö‡∏°‡∏≤‡∏û‡∏ö‡πÅ‡∏û‡∏ó‡∏¢‡πå',
            o: '‡∏ô‡∏±‡∏î‡∏ü‡∏±‡∏á‡∏ú‡∏• X-ray ‡∏õ‡∏≠‡∏î‡∏ã‡πâ‡∏≥ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ..................... ‡∏ó‡∏µ‡πà‡∏Ñ‡∏•‡∏¥‡∏ô‡∏¥‡∏Å‡∏≠‡∏≤‡∏¢‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°',
            d2: '‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏Ñ‡∏£‡∏ö 5 ‡∏´‡∏°‡∏π‡πà ‡∏õ‡∏£‡∏∏‡∏á‡∏™‡∏∏‡∏Å‡∏™‡∏∞‡∏≠‡∏≤‡∏î ‡∏î‡∏∑‡πà‡∏°‡∏ô‡πâ‡∏≥‡∏≠‡∏∏‡πà‡∏ô‡∏°‡∏≤‡∏Å‡πÜ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ä‡πà‡∏ß‡∏¢‡∏•‡∏∞‡∏•‡∏≤‡∏¢‡πÄ‡∏™‡∏°‡∏´‡∏∞'
        },
        {
            id: 'MED02', title: '‡πÄ‡∏ö‡∏≤‡∏´‡∏ß‡∏≤‡∏ô (Diabetes Mellitus)',
            d: '‡πÇ‡∏£‡∏Ñ‡πÄ‡∏ö‡∏≤‡∏´‡∏ß‡∏≤‡∏ô (DM) ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•‡πÉ‡∏ô‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡∏™‡∏π‡∏á',
            m: '1. ‡∏¢‡∏≤‡∏•‡∏î‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏• (Metformin/Glipizide) ‡∏ó‡∏≤‡∏ô‡∏Å‡πà‡∏≠‡∏ô/‡∏´‡∏•‡∏±‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏ï‡∏≤‡∏°‡∏™‡∏±‡πà‡∏á‡πÄ‡∏Ñ‡∏£‡πà‡∏á‡∏Ñ‡∏£‡∏±‡∏î\n2. ‡∏¢‡∏≤‡∏â‡∏µ‡∏î‡∏≠‡∏¥‡∏ô‡∏ã‡∏π‡∏•‡∏¥‡∏ô (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ) ‡∏â‡∏µ‡∏î‡∏ï‡∏≤‡∏°‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏•‡∏∞‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ‡∏ó‡∏µ‡πà‡∏™‡∏≠‡∏ô',
            e: '‡∏£‡∏∞‡∏ß‡∏±‡∏á‡∏Ç‡∏≠‡∏á‡∏°‡∏µ‡∏Ñ‡∏°‡∏ï‡∏≤‡∏°‡∏û‡∏∑‡πâ‡∏ô ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡∏¥‡∏î‡πÅ‡∏ú‡∏•‡∏ó‡∏µ‡πà‡πÄ‡∏ó‡πâ‡∏≤ ‡∏™‡∏ß‡∏°‡∏£‡∏≠‡∏á‡πÄ‡∏ó‡πâ‡∏≤‡πÉ‡∏ô‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏™‡∏°‡∏≠',
            t: '1. ‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢‡∏™‡∏°‡πà‡∏≥‡πÄ‡∏™‡∏°‡∏≠ ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 30 ‡∏ô‡∏≤‡∏ó‡∏µ/‡∏ß‡∏±‡∏ô\n2. ‡∏ï‡∏£‡∏ß‡∏à‡πÄ‡∏ó‡πâ‡∏≤‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô ‡∏´‡πâ‡∏≤‡∏°‡πÅ‡∏ä‡πà‡πÄ‡∏ó‡πâ‡∏≤‡πÉ‡∏ô‡∏ô‡πâ‡∏≥‡∏£‡πâ‡∏≠‡∏ô\n3. ‡∏ï‡∏±‡∏î‡πÄ‡∏•‡πá‡∏ö‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏£‡∏∞‡∏°‡∏±‡∏î‡∏£‡∏∞‡∏ß‡∏±‡∏á',
            h: '‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•‡∏ï‡πà‡∏≥: ‡πÉ‡∏à‡∏™‡∏±‡πà‡∏ô ‡πÄ‡∏´‡∏á‡∏∑‡πà‡∏≠‡∏≠‡∏≠‡∏Å ‡∏´‡∏ô‡πâ‡∏≤‡∏°‡∏∑‡∏î (‡πÉ‡∏´‡πâ‡∏î‡∏∑‡πà‡∏°‡∏ô‡πâ‡∏≥‡∏´‡∏ß‡∏≤‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ)\n‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•‡∏™‡∏π‡∏á: ‡∏´‡∏¥‡∏ß‡∏ô‡πâ‡∏≥‡∏ö‡πà‡∏≠‡∏¢ ‡∏õ‡∏±‡∏™‡∏™‡∏≤‡∏ß‡∏∞‡∏ö‡πà‡∏≠‡∏¢ ‡∏ú‡∏≠‡∏°‡∏•‡∏á',
            o: '‡∏ô‡∏±‡∏î‡πÄ‡∏à‡∏≤‡∏∞‡πÄ‡∏•‡∏∑‡∏≠‡∏î (NPO ‡∏á‡∏î‡∏ô‡πâ‡∏≥‡∏á‡∏î‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏á‡∏Ñ‡∏∑‡∏ô) ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà .....................',
            d2: '‡∏à‡∏≥‡∏Å‡∏±‡∏î‡πÅ‡∏õ‡πâ‡∏á‡πÅ‡∏•‡∏∞‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏• (‡∏Ç‡πâ‡∏≤‡∏ß ‡∏Ç‡∏ô‡∏°‡∏õ‡∏±‡∏á ‡∏ú‡∏•‡πÑ‡∏°‡πâ‡∏´‡∏ß‡∏≤‡∏ô) ‡∏á‡∏î‡∏Ç‡∏≠‡∏á‡∏´‡∏ß‡∏≤‡∏ô ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏°‡∏ä‡∏π‡∏Å‡∏≥‡∏•‡∏±‡∏á ‡∏ô‡πâ‡∏≥‡∏≠‡∏±‡∏î‡∏•‡∏°'
        },
        {
            id: 'MED03', title: '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô‡πÇ‡∏•‡∏´‡∏¥‡∏ï‡∏™‡∏π‡∏á (Hypertension)',
            d: '‡πÇ‡∏£‡∏Ñ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô‡πÇ‡∏•‡∏´‡∏¥‡∏ï‡∏™‡∏π‡∏á (Essential Hypertension)',
            m: '‡∏¢‡∏≤‡∏ï‡πâ‡∏≤‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô‡πÇ‡∏•‡∏´‡∏¥‡∏ï ‡∏ó‡∏≤‡∏ô‡∏™‡∏°‡πà‡∏≥‡πÄ‡∏™‡∏°‡∏≠‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô ‡∏´‡πâ‡∏≤‡∏°‡∏´‡∏¢‡∏∏‡∏î‡∏¢‡∏≤‡πÄ‡∏≠‡∏á‡πÅ‡∏°‡πâ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏≤‡∏Å‡∏≤‡∏£',
            e: '‡∏ö‡∏£‡∏£‡∏¢‡∏≤‡∏Å‡∏≤‡∏®‡∏™‡∏á‡∏ö ‡∏•‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ñ‡∏£‡∏µ‡∏¢‡∏î ‡∏´‡∏•‡∏µ‡∏Å‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏î‡∏±‡∏á',
            t: '1. ‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏ï‡∏±‡∏ß\n2. ‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢‡πÅ‡∏ö‡∏ö‡πÅ‡∏≠‡πÇ‡∏£‡∏ö‡∏¥‡∏Ñ‡πÄ‡∏ö‡∏≤‡πÜ\n3. ‡∏ß‡∏±‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô‡πÇ‡∏•‡∏´‡∏¥‡∏ï‡∏™‡∏°‡πà‡∏≥‡πÄ‡∏™‡∏°‡∏≠‡∏ó‡∏µ‡πà‡∏ö‡πâ‡∏≤‡∏ô',
            h: '‡∏´‡∏≤‡∏Å‡∏õ‡∏ß‡∏î‡∏®‡∏µ‡∏£‡∏©‡∏∞‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á ‡∏ï‡∏≤‡∏û‡∏£‡πà‡∏≤‡∏°‡∏±‡∏ß ‡∏´‡∏ô‡πâ‡∏≤‡∏°‡∏∑‡∏î ‡∏´‡∏£‡∏∑‡∏≠‡∏ß‡∏±‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô‡πÑ‡∏î‡πâ > 160/100 mmHg ‡πÉ‡∏´‡πâ‡∏£‡∏µ‡∏ö‡∏°‡∏≤‡∏û‡∏ö‡πÅ‡∏û‡∏ó‡∏¢‡πå',
            o: '‡∏ô‡∏±‡∏î‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏≠‡∏≤‡∏Å‡∏≤‡∏£ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ..................... ‡∏ó‡∏µ‡πà‡∏Ñ‡∏•‡∏¥‡∏ô‡∏¥‡∏Å NCD',
            d2: '‡∏•‡∏î‡πÄ‡∏Ñ‡πá‡∏° (‡∏à‡∏≥‡∏Å‡∏±‡∏î‡πÇ‡∏ã‡πÄ‡∏î‡∏µ‡∏¢‡∏°) ‡∏á‡∏î‡∏ú‡∏á‡∏ä‡∏π‡∏£‡∏™ ‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏´‡∏°‡∏±‡∏Å‡∏î‡∏≠‡∏á ‡∏õ‡∏•‡∏≤‡πÄ‡∏Ñ‡πá‡∏° ‡πÑ‡∏Ç‡πà‡πÄ‡∏Ñ‡πá‡∏°'
        },
        {
            id: 'ORTHO01', title: '‡∏Å‡∏£‡∏∞‡∏î‡∏π‡∏Å‡∏´‡∏±‡∏Å/‡πÉ‡∏™‡πà‡πÄ‡∏ù‡∏∑‡∏≠‡∏Å (Fracture)',
            d: '‡∏Å‡∏£‡∏∞‡∏î‡∏π‡∏Å‡∏´‡∏±‡∏Å (Fracture) ‡∏ó‡∏µ‡πà‡∏ö‡∏£‡∏¥‡πÄ‡∏ß‡∏ì ..................... ‡πÉ‡∏™‡πà‡πÄ‡∏ù‡∏∑‡∏≠‡∏Å/‡∏î‡∏≤‡∏°‡πÄ‡∏´‡∏•‡πá‡∏Å',
            m: '‡∏¢‡∏≤‡πÅ‡∏Å‡πâ‡∏õ‡∏ß‡∏î ‡πÅ‡∏•‡∏∞‡πÅ‡∏Ñ‡∏•‡πÄ‡∏ã‡∏µ‡∏¢‡∏°‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏Å‡∏£‡∏∞‡∏î‡∏π‡∏Å ‡∏ï‡∏≤‡∏°‡πÅ‡∏û‡∏ó‡∏¢‡πå‡∏™‡∏±‡πà‡∏á',
            e: '‡∏à‡∏±‡∏î‡∏ö‡πâ‡∏≤‡∏ô‡πÉ‡∏´‡πâ‡πÇ‡∏•‡πà‡∏á ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏∞‡∏î‡∏∏‡∏î‡∏´‡∏Å‡∏•‡πâ‡∏° ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡πâ‡∏≠‡∏á‡∏ô‡πâ‡∏≥‡πÑ‡∏°‡πà‡∏•‡∏∑‡πà‡∏ô',
            t: '1. ‡∏´‡πâ‡∏≤‡∏°‡∏•‡∏á‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏Ç‡∏≤‡∏Ç‡πâ‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏´‡∏±‡∏Å (‡πÉ‡∏ä‡πâ‡πÑ‡∏°‡πâ‡∏Ñ‡πâ‡∏≥‡∏¢‡∏±‡∏ô‡∏ï‡∏≤‡∏°‡∏™‡∏≠‡∏ô)\n2. ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡πÄ‡∏Å‡∏£‡πá‡∏á‡∏Å‡∏•‡πâ‡∏≤‡∏°‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡πÉ‡∏ô‡πÄ‡∏ù‡∏∑‡∏≠‡∏Å (Isometric exercise)\n3. ‡∏´‡πâ‡∏≤‡∏°‡πÉ‡∏´‡πâ‡πÄ‡∏ù‡∏∑‡∏≠‡∏Å‡πÄ‡∏õ‡∏µ‡∏¢‡∏Å‡∏ô‡πâ‡∏≥/‡∏´‡πâ‡∏≤‡∏°‡πÄ‡∏≠‡∏≤‡πÑ‡∏°‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡πÄ‡∏Å‡∏≤',
            h: '‡∏´‡∏≤‡∏Å‡∏õ‡∏•‡∏≤‡∏¢‡∏°‡∏∑‡∏≠/‡πÄ‡∏ó‡πâ‡∏≤ ‡∏ö‡∏ß‡∏° ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡∏Ñ‡∏•‡πâ‡∏≥ ‡∏ä‡∏≤ ‡∏´‡∏£‡∏∑‡∏≠‡∏õ‡∏ß‡∏î‡∏°‡∏≤‡∏Å‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥ ‡πÉ‡∏´‡πâ‡∏£‡∏µ‡∏ö‡∏°‡∏≤ ‡∏£‡∏û. ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ',
            o: '‡∏ô‡∏±‡∏î X-ray ‡∏î‡∏π‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏Ç‡∏≠‡∏á‡∏Å‡∏£‡∏∞‡∏î‡∏π‡∏Å ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà .....................',
            d2: '‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡∏ï‡∏µ‡∏ô‡∏™‡∏π‡∏á (‡πÄ‡∏ô‡∏∑‡πâ‡∏≠ ‡∏ô‡∏° ‡πÑ‡∏Ç‡πà) ‡πÅ‡∏•‡∏∞‡πÅ‡∏Ñ‡∏•‡πÄ‡∏ã‡∏µ‡∏¢‡∏°‡∏™‡∏π‡∏á ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏™‡∏£‡∏¥‡∏°‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏£‡∏∞‡∏î‡∏π‡∏Å'
        }
    ];

    // -------------------------------------------------------------------
    // 2. Logic ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
    // -------------------------------------------------------------------
    
    // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢
    const patientProfile = JSON.parse(localStorage.getItem('patientProfile'));
    
    if(patientProfile) {
        document.getElementById('ptName').innerText = patientProfile.name;
        document.getElementById('ptHN').innerText = patientProfile.hn;
        document.getElementById('ptAN').innerText = patientProfile.an;
        document.getElementById('ptWard').innerText = patientProfile.ward;
        
        // Print Header
        document.getElementById('pNamePrint').innerText = patientProfile.name;
        document.getElementById('pHNPrint').innerText = patientProfile.hn;
        document.getElementById('pWardPrint').innerText = patientProfile.ward;

        // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤‡∏ñ‡πâ‡∏≤‡πÄ‡∏Ñ‡∏¢‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ
        loadDischargeNote();
    } else {
        alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö"); window.location.href = 'ward.html';
    }

    // Render List Template
    function renderTemplates() {
        const searchText = document.getElementById('searchTemplate').value.toLowerCase();
        const listDiv = document.getElementById('templateList');
        listDiv.innerHTML = '';

        const filtered = dischargeTemplates.filter(t => t.title.toLowerCase().includes(searchText));

        if(filtered.length === 0) {
            listDiv.innerHTML = '<div style="text-align:center; color:#999; padding:20px;">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</div>';
            return;
        }

        filtered.forEach(t => {
            const div = document.createElement('div');
            div.className = 'template-item';
            div.innerHTML = `
                <strong>${t.title}</strong>
                <small>${t.id}</small>
            `;
            // ‡∏Ñ‡∏•‡∏¥‡∏Å‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏ï‡∏¥‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
            div.onclick = () => fillForm(t);
            listDiv.appendChild(div);
        });
    }

    // ‡πÄ‡∏ï‡∏¥‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°
    function fillForm(data) {
        if(!confirm("‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏ó‡∏±‡∏ö‡∏î‡πâ‡∏ß‡∏¢ Template ‡πÉ‡∏´‡∏°‡πà ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÑ‡∏´‡∏°?")) return;
        document.getElementById('inp_d').value = data.d || '';
        document.getElementById('inp_m').value = data.m || '';
        document.getElementById('inp_e').value = data.e || '';
        document.getElementById('inp_t').value = data.t || '';
        document.getElementById('inp_h').value = data.h || '';
        document.getElementById('inp_o').value = data.o || '';
        document.getElementById('inp_d2').value = data.d2 || '';
    }

    // --- CRUD ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏ô‡πÑ‡∏Ç‡πâ (Save/Load) ---

    function saveDischargeNote() {
        if(!patientProfile) return;
        const noteData = {
            d: document.getElementById('inp_d').value,
            m: document.getElementById('inp_m').value,
            e: document.getElementById('inp_e').value,
            t: document.getElementById('inp_t').value,
            h: document.getElementById('inp_h').value,
            o: document.getElementById('inp_o').value,
            d2: document.getElementById('inp_d2').value,
            savedAt: new Date().toLocaleString()
        };
        
        // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á LocalStorage ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ Key ‡πÄ‡∏õ‡πá‡∏ô HN ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏ô‡πÑ‡∏Ç‡πâ
        const storageKey = `discharge_note_${patientProfile.hn}`;
        localStorage.setItem(storageKey, JSON.stringify(noteData));
        
        alert(`‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á ${patientProfile.name} ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!`);
    }

    function loadDischargeNote() {
        if(!patientProfile) return;
        const storageKey = `discharge_note_${patientProfile.hn}`;
        const savedData = JSON.parse(localStorage.getItem(storageKey));

        if(savedData) {
            document.getElementById('inp_d').value = savedData.d || '';
            document.getElementById('inp_m').value = savedData.m || '';
            document.getElementById('inp_e').value = savedData.e || '';
            document.getElementById('inp_t').value = savedData.t || '';
            document.getElementById('inp_h').value = savedData.h || '';
            document.getElementById('inp_o').value = savedData.o || '';
            document.getElementById('inp_d2').value = savedData.d2 || '';
        }
    }

    function clearForm() {
        if(confirm("‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?")) {
            document.querySelectorAll('textarea').forEach(el => el.value = '');
        }
    }

    // Init
    renderTemplates();

</script>
</body>
</html>
