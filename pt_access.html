<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patient Admission Assessment Form (Part II)</title>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <style>
        :root {
            --primary: #219ebc; /* ‡∏™‡∏µ‡∏ü‡πâ‡∏≤‡∏™‡∏î‡πÉ‡∏™ */
            --secondary: #023047; /* ‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏Ç‡πâ‡∏° */
            --accent: #fb8500; /* ‡∏™‡∏µ‡∏™‡πâ‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç */
            --bg: #f1faee;
            --border: #a8dadc;
        }

        body { font-family: 'Sarabun', sans-serif; background: var(--bg); margin: 0; padding: 20px; color: #333; font-size: 14px; }
        
        .container { 
            max-width: 210mm; 
            margin: 0 auto; 
            background: #fff; 
            padding: 30px; 
            border-radius: 8px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.08); 
            border-top: 10px solid var(--primary);
        }

        /* --- Header Styling --- */
        .main-header {
            text-align: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px dashed #ccc;
        }
        .main-header h1 { margin: 0; font-size: 20px; color: var(--secondary); text-transform: uppercase; }
        .main-header p { margin: 5px 0 0; font-size: 14px; color: #666; font-style: italic; }

        /* --- Layout --- */
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 10px; }
        .grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-bottom: 10px; }
        .grid-4 { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 10px; }
        
        .row { display: flex; gap: 10px; margin-bottom: 8px; align-items: center; flex-wrap: wrap; }
        .flex-grow { flex-grow: 1; }

        /* --- Form Inputs --- */
        label { font-weight: 600; color: var(--secondary); margin-right: 5px; }
        input[type="text"], input[type="number"], input[type="date"], input[type="datetime-local"], select, textarea {
            padding: 5px 8px; border: 1px solid #ccc; border-radius: 4px; font-family: 'Sarabun';
        }
        input[type="text"]:focus { border-color: var(--primary); outline: none; }
        /* ‡∏ä‡πà‡∏≠‡∏á BMI ‡πÉ‡∏´‡πâ‡∏≠‡πà‡∏≤‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß */
        #bmi_val { background-color: #e9ecef; cursor: not-allowed; font-weight: bold; color: var(--primary); }
        
        textarea { width: 100%; box-sizing: border-box; resize: vertical; }

        /* --- Custom Checklist Items --- */
        .check-group { display: flex; flex-wrap: wrap; gap: 12px; align-items: center; }
        .check-item { 
            display: flex; align-items: center; gap: 4px; 
            background: #f8f9fa; padding: 4px 8px; border-radius: 15px; border: 1px solid #e9ecef; cursor: pointer;
        }
        .check-item:hover { background: #e0fbfc; border-color: var(--primary); }
        .check-item input { margin: 0; cursor: pointer; }
        .check-item span { font-weight: 400; font-size: 13px; }

        /* --- Section Headers --- */
        .sect-title { 
            background: var(--secondary); color: #fff; 
            padding: 6px 12px; border-radius: 4px; margin: 20px 0 10px 0; font-size: 15px; 
            display: flex; align-items: center; gap: 8px;
        }
        fieldset { border: 1px solid var(--border); border-radius: 6px; padding: 10px 15px; margin-bottom: 15px; background: #fff; }
        legend { font-weight: bold; color: var(--primary); padding: 0 8px; }

        /* --- Tabs --- */
        .tabs { display: flex; margin-bottom: 20px; border-bottom: 2px solid #ddd; }
        .tab-btn { 
            padding: 10px 25px; background: none; border: none; font-size: 16px; 
            cursor: pointer; color: #777; font-weight: bold; font-family: 'Sarabun';
            border-bottom: 4px solid transparent; transition: 0.3s;
        }
        .tab-btn:hover { color: var(--primary); background: #f0f9ff; }
        .tab-btn.active { color: var(--primary); border-bottom-color: var(--primary); }
        
        .tab-content { display: none; animation: fadeIn 0.4s; }
        .tab-content.active { display: block; }

        /* --- Buttons --- */
        .action-bar { 
            position: sticky; bottom: 0; background: #fff; padding: 15px; 
            border-top: 1px solid #ddd; text-align: right; box-shadow: 0 -5px 15px rgba(0,0,0,0.05); z-index: 99; 
        }
        .btn { padding: 8px 20px; border: none; border-radius: 20px; cursor: pointer; color: #fff; font-size: 14px; margin-left: 8px; font-weight: 600; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        .btn:active { transform: scale(0.98); }
        .btn-save { background: #2a9d8f; }
        .btn-del { background: #e63946; }
        .btn-pdf { background: #023e8a; }
        .btn-search { background: var(--accent); padding: 5px 15px; color: white; border-radius: 4px; }
        .back-btn { background: #6c757d; }

        /* Print Settings */
        @media print {
            .action-bar, .tabs, .btn-search, .no-print { display: none !important; }
            .tab-content { display: block !important; margin-bottom: 30px; page-break-after: always; }
            .container { box-shadow: none; border: none; padding: 0; max-width: 100%; width: 100%; }
            body { background: white; padding: 0; }
            .check-item { border: none; background: none; padding: 0; } 
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<div class="container" id="form-container">
    
    <div class="main-header">
        <h1>PATIENT ADMISSION ASSESSMENT FORM (PART II)</h1>
        <p>(To be completed by RN within 8 hr.)</p>
    </div>

    <div style="background: #e9ecef; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
        <div class="grid-4">
            <div><label>‡∏ä‡∏∑‡πà‡∏≠:</label> <input type="text" id="pt_name" style="width: 100%;"></div>
            <div><label>‡∏™‡∏Å‡∏∏‡∏•:</label> <input type="text" id="pt_surname" style="width: 100%;"></div>
            <div><label>HN:</label> <input type="text" id="pt_hn" style="width: 100%;"></div>
            <div style="display:flex; align-items:end; gap:5px;">
                <div style="flex-grow:1;">
                    <label style="color:var(--accent);">AN (‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤/‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å):</label>
                    <input type="text" id="pt_an" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏•‡∏Ç AN" style="width: 100%;">
                </div>
                <button class="btn-search" onclick="searchData()">üîç</button>
            </div>
        </div>
    </div>

    <div class="tabs" data-html2canvas-ignore="true">
        <button class="tab-btn active" onclick="openTab('page1')">1. ‡πÅ‡∏£‡∏Å‡∏£‡∏±‡∏ö/Vitals</button>
        <button class="tab-btn" onclick="openTab('page2')">2. ‡∏£‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏¢/Pain</button>
        <button class="tab-btn" onclick="openTab('page3')">3. Braden/ADL/Hx</button>
        <button class="tab-btn" onclick="openTab('page4')">4. Nutri/D-C</button>
    </div>

    <div id="page1" class="tab-content active">
        <div class="sect-title">üìù ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡πÉ‡∏´‡∏°‡πà (Admission Data)</div>
        
        <div class="grid-2">
            <div><label>‡∏†‡∏≤‡∏©‡∏≤‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ:</label> <input type="text" id="lang" placeholder="‡πÑ‡∏ó‡∏¢/‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©/..."></div>
            <div><label>‡∏ß‡∏±‡∏ô-‡πÄ‡∏ß‡∏•‡∏≤‡∏ñ‡∏∂‡∏á‡∏ï‡∏∂‡∏Å:</label> <input type="datetime-local" id="arrive_dt"></div>
        </div>

        <fieldset>
            <legend>‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡πâ‡∏¢‡∏≤/‡∏≠‡∏≤‡∏´‡∏≤‡∏£ (Allergies)</legend>
            <div class="row">
                <div class="check-group">
                    <label class="check-item"><input type="radio" name="drug_alg" value="No" checked> <span>‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò‡πÅ‡∏û‡πâ‡∏¢‡∏≤</span></label>
                    <label class="check-item"><input type="radio" name="drug_alg" value="Yes"> <span>‡πÅ‡∏û‡πâ‡∏¢‡∏≤ (‡∏£‡∏∞‡∏ö‡∏∏)</span></label>
                </div>
                <input type="text" id="drug_name" class="flex-grow" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏¢‡∏≤/‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡πâ">
            </div>
            <div class="row" style="margin-top:5px;">
                <div class="check-group">
                    <label class="check-item"><input type="radio" name="food_alg" value="No" checked> <span>‡πÑ‡∏°‡πà‡πÅ‡∏û‡πâ‡∏≠‡∏≤‡∏´‡∏≤‡∏£</span></label>
                    <label class="check-item"><input type="radio" name="food_alg" value="Yes"> <span>‡πÅ‡∏û‡πâ‡∏≠‡∏≤‡∏´‡∏≤‡∏£ (‡∏£‡∏∞‡∏ö‡∏∏)</span></label>
                </div>
                <input type="text" id="food_name" class="flex-grow">
            </div>
        </fieldset>

        <div class="grid-2">
            <fieldset>
                <legend>‡∏Å‡∏≤‡∏£‡∏°‡∏≤‡∏ñ‡∏∂‡∏á & ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå</legend>
                <label>‡∏°‡∏≤‡∏ñ‡∏∂‡∏á‡πÇ‡∏î‡∏¢:</label>
                <div class="check-group" style="margin-bottom:8px;">
                    <label class="check-item"><input type="radio" name="arr_by" value="Walk"> <span>‡πÄ‡∏î‡∏¥‡∏ô‡∏°‡∏≤‡πÄ‡∏≠‡∏á</span></label>
                    <label class="check-item"><input type="radio" name="arr_by" value="Wheelchair"> <span>‡∏£‡∏ñ‡∏ô‡∏±‡πà‡∏á</span></label>
                    <label class="check-item"><input type="radio" name="arr_by" value="Stretcher"> <span>‡∏£‡∏ñ‡∏ô‡∏≠‡∏ô</span></label>
                    <label class="check-item"><input type="radio" name="arr_by" value="Carried"> <span>‡∏≠‡∏∏‡πâ‡∏°‡∏°‡∏≤</span></label>
                </div>
                <label>‡∏£‡∏±‡∏ö‡πÉ‡∏´‡∏°‡πà‡∏à‡∏≤‡∏Å:</label>
                <div class="check-group" style="margin-bottom:8px;">
                    <label class="check-item"><input type="radio" name="src" value="ER"> <span>ER</span></label>
                    <label class="check-item"><input type="radio" name="src" value="OPD"> <span>OPD</span></label>
                    <label class="check-item"><input type="radio" name="src" value="Refer"> <span>Refer</span></label>
                </div>
                <label>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å:</label>
                <div class="check-group">
                    <label class="check-item"><input type="checkbox" id="info_pt"> <span>‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢</span></label>
                    <label class="check-item"><input type="checkbox" id="info_rel"> <span>‡∏ç‡∏≤‡∏ï‡∏¥</span></label>
                    <label class="check-item"><input type="checkbox" id="info_card"> <span>OPD Card</span></label>
                </div>
            </fieldset>
            <fieldset>
                <legend>‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÅ‡∏£‡∏Å‡∏£‡∏±‡∏ö</legend>
                <label>CC:</label> <input type="text" id="cc" style="width:100%; margin-bottom:5px;">
                <label>PI:</label> <textarea id="pi" rows="2"></textarea>
                <label>Dx:</label> <input type="text" id="dx" style="width:100%;">
            </fieldset>
        </div>

        <div class="sect-title">ü©∫ ‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì‡∏ä‡∏µ‡∏û & ‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡∏•‡∏±‡∏Å (Vitals & Systems)</div>
        <div class="grid-4" style="background:#f8f9fa; padding:10px; border-radius:5px;">
            <div><label>T (¬∞C)</label><input type="number" id="vs_t" step="0.1" class="flex-grow"></div>
            <div><label>PR (/min)</label><input type="number" id="vs_pr" class="flex-grow"></div>
            <div><label>RR (/min)</label><input type="number" id="vs_rr" class="flex-grow"></div>
            <div><label>BP (mmHg)</label><input type="text" id="vs_bp" class="flex-grow"></div>
            <div><label>O2 Sat</label><input type="number" id="vs_o2" class="flex-grow"></div>
            <div><label>BW (kg)</label><input type="number" id="vs_bw" class="flex-grow" oninput="calculateBMI()"></div>
            <div><label>HT (cm)</label><input type="number" id="vs_ht" class="flex-grow" oninput="calculateBMI()"></div>
            <div><label>Pain Score</label><input type="number" id="vs_pain"></div>
        </div>

        <fieldset>
            <legend>‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡∏™‡∏≤‡∏ó (Neuro)</legend>
            <div class="check-group">
                <label>‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å:</label>
                <label class="check-item"><input type="radio" name="neuro" value="Alert"> <span>‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡∏ï‡∏±‡∏ß‡∏î‡∏µ</span></label>
                <label class="check-item"><input type="radio" name="neuro" value="Drowsy"> <span>‡∏ã‡∏∂‡∏°/‡∏á‡πà‡∏ß‡∏á</span></label>
                <label class="check-item"><input type="radio" name="neuro" value="Confusion"> <span>‡∏™‡∏±‡∏ö‡∏™‡∏ô</span></label>
                <label class="check-item"><input type="radio" name="neuro" value="Coma"> <span>‡πÑ‡∏°‡πà‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡∏ï‡∏±‡∏ß</span></label>
            </div>
            <div class="row" style="margin-top:8px;">
                <label>Glasgow Coma Score:</label> 
                E <input type="number" id="gcs_e" style="width:40px"> 
                M <input type="number" id="gcs_m" style="width:40px"> 
                V <input type="number" id="gcs_v" style="width:40px">
            </div>
            <div class="row" style="margin-top:8px;">
                <label>‡∏≠‡∏∑‡πà‡∏ô‡πÜ/‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:</label>
                <input type="text" id="neuro_other" class="flex-grow" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏ó‡∏≤‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡∏™‡∏≤‡∏ó‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°...">
            </div>
        </fieldset>
    </div>

    <div id="page2" class="tab-content">
        <div class="sect-title">üîé ‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏£‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏¢ (Physical Exam)</div>
        
        <div class="grid-2">
            <fieldset>
                <legend>‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡πâ‡∏≠‡∏á (Abdomen)</legend>
                <div class="check-group">
                    <label class="check-item"><input type="checkbox" id="abd_norm"> <span>‡∏õ‡∏Å‡∏ï‡∏¥</span></label>
                    <label class="check-item"><input type="checkbox" id="abd_dist"> <span>‡∏ö‡∏ß‡∏°‡∏ï‡∏∂‡∏á</span></label>
                    <label class="check-item"><input type="checkbox" id="abd_mass"> <span>‡∏°‡∏µ‡∏Å‡πâ‡∏≠‡∏ô</span></label>
                    <label class="check-item"><input type="checkbox" id="abd_pain"> <span>‡∏Å‡∏î‡πÄ‡∏à‡πá‡∏ö</span></label>
                </div>
                <input type="text" id="abd_other" placeholder="‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡∏£‡∏∞‡∏ö‡∏∏..." style="width:100%; margin-top:5px;">
            </fieldset>
            <fieldset>
                <legend>‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏±‡∏™‡∏™‡∏≤‡∏ß‡∏∞ (Urine)</legend>
                <div class="check-group">
                    <label class="check-item"><input type="checkbox" id="uri_norm"> <span>‡∏õ‡∏Å‡∏ï‡∏¥</span></label>
                    <label class="check-item"><input type="checkbox" id="uri_freq"> <span>‡∏ö‡πà‡∏≠‡∏¢</span></label>
                    <label class="check-item"><input type="checkbox" id="uri_burn"> <span>‡πÅ‡∏™‡∏ö‡∏Ç‡∏±‡∏î</span></label>
                    <label class="check-item"><input type="checkbox" id="uri_blood"> <span>‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡∏õ‡∏ô</span></label>
                </div>
                <div class="row" style="margin-top:5px;">
                    <label class="check-item"><input type="checkbox" id="uri_foley"> <span>‡∏™‡∏≤‡∏¢‡∏™‡∏ß‡∏ô (Foley)</span></label>
                    <input type="text" id="foley_no" placeholder="No./Date" class="flex-grow">
                </div>
                <div class="row" style="margin-top:5px;">
                    <label>‡∏≠‡∏∑‡πà‡∏ô‡πÜ:</label>
                    <input type="text" id="uri_other" class="flex-grow" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥‡∏≠‡∏∑‡πà‡∏ô‡πÜ...">
                </div>
            </fieldset>
        </div>

        <fieldset>
            <legend>‡∏ú‡∏¥‡∏ß‡∏´‡∏ô‡∏±‡∏á (Skin)</legend>
            <div class="check-group">
                <label class="check-item"><input type="checkbox" id="skin_norm"> <span>‡∏õ‡∏Å‡∏ï‡∏¥</span></label>
                <label class="check-item"><input type="checkbox" id="skin_pale"> <span>‡∏ã‡∏µ‡∏î</span></label>
                <label class="check-item"><input type="checkbox" id="skin_dry"> <span>‡πÅ‡∏´‡πâ‡∏á</span></label>
                <label class="check-item"><input type="checkbox" id="skin_jaundice"> <span>‡∏ï‡∏±‡∏ß‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á</span></label>
                <label class="check-item"><input type="checkbox" id="skin_rash"> <span>‡∏°‡∏µ‡∏ú‡∏∑‡πà‡∏ô</span></label>
                <label class="check-item"><input type="checkbox" id="skin_cyanosis"> <span>‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡∏Ñ‡∏•‡πâ‡∏≥</span></label>
            </div>
            <div class="row" style="margin-top:8px;">
                <label>‡∏≠‡∏∑‡πà‡∏ô‡πÜ:</label>
                <input type="text" id="skin_other" class="flex-grow" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡∏ú‡∏¥‡∏ß‡∏´‡∏ô‡∏±‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°...">
            </div>
        </fieldset>

        <fieldset>
            <legend>‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£ (Communication)</legend>
            <div class="grid-3">
                <div>
                    <label>‡∏Å‡∏≤‡∏£‡∏û‡∏π‡∏î:</label>
                    <div class="check-group">
                        <label class="check-item"><input type="radio" name="comm_spk" value="Clear"> <span>‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô</span></label>
                        <label class="check-item"><input type="radio" name="comm_spk" value="Mute"> <span>‡πÉ‡∏ö‡πâ</span></label>
                    </div>
                </div>
                <div>
                    <label>‡∏Å‡∏≤‡∏£‡πÑ‡∏î‡πâ‡∏¢‡∏¥‡∏ô:</label>
                    <div class="check-group">
                        <label class="check-item"><input type="radio" name="comm_hear" value="Normal"> <span>‡∏õ‡∏Å‡∏ï‡∏¥</span></label>
                        <label class="check-item"><input type="radio" name="comm_hear" value="Deaf"> <span>‡∏ï‡∏∂‡∏á/‡∏´‡∏ô‡∏ß‡∏Å</span></label>
                    </div>
                </div>
                <div>
                    <label>‡∏Å‡∏≤‡∏£‡∏°‡∏≠‡∏á‡πÄ‡∏´‡πá‡∏ô:</label>
                    <div class="check-group">
                        <label class="check-item"><input type="radio" name="comm_see" value="Normal"> <span>‡∏õ‡∏Å‡∏ï‡∏¥</span></label>
                        <label class="check-item"><input type="radio" name="comm_see" value="Blur"> <span>‡∏°‡∏±‡∏ß/‡∏ö‡∏≠‡∏î</span></label>
                    </div>
                </div>
            </div>
            <div class="row" style="margin-top:8px;">
                <label>‡∏≠‡∏∑‡πà‡∏ô‡πÜ:</label>
                <input type="text" id="comm_other" class="flex-grow" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° (‡πÄ‡∏ä‡πà‡∏ô ‡πÉ‡∏ä‡πâ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ä‡πà‡∏ß‡∏¢‡∏ü‡∏±‡∏á, ‡πÅ‡∏ß‡πà‡∏ô‡∏ï‡∏≤)...">
            </div>
        </fieldset>

        <div class="sect-title">‚ö° ‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏ß‡∏î (Pain Assessment)</div>
        <fieldset>
            <div class="row">
                <label>‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠:</label>
                <div class="check-group">
                    <label class="check-item"><input type="radio" name="pain_tool" value="NRS"> <span>NRS (‡∏ú‡∏π‡πâ‡πÉ‡∏´‡∏ç‡πà)</span></label>
                    <label class="check-item"><input type="radio" name="pain_tool" value="FACES"> <span>FACES (‡πÄ‡∏î‡πá‡∏Å‡πÇ‡∏ï)</span></label>
                    <label class="check-item"><input type="radio" name="pain_tool" value="FLACC"> <span>FLACC (‡πÄ‡∏î‡πá‡∏Å‡πÄ‡∏•‡πá‡∏Å)</span></label>
                </div>
            </div>
            <div class="grid-2" style="margin-top:10px;">
                <div>
                    <label>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô (0-10):</label> 
                    <input type="number" id="pain_sc" style="width:60px; font-size:16px; font-weight:bold; text-align:center;">
                </div>
                <div>
                    <label>‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á:</label>
                    <input type="text" id="pain_loc" style="width:80%;">
                </div>
            </div>
            <div class="row" style="margin-top:10px;">
                <label>‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡∏õ‡∏ß‡∏î:</label>
                <div class="check-group">
                    <label class="check-item"><input type="checkbox" id="pain_ache"> <span>‡∏ï‡∏∑‡πâ‡∏≠‡πÜ</span></label>
                    <label class="check-item"><input type="checkbox" id="pain_sharp"> <span>‡πÅ‡∏õ‡∏•‡πä‡∏ö‡πÜ</span></label>
                    <label class="check-item"><input type="checkbox" id="pain_burn"> <span>‡πÅ‡∏™‡∏ö‡∏£‡πâ‡∏≠‡∏ô</span></label>
                    <label class="check-item"><input type="checkbox" id="pain_sqz"> <span>‡∏ö‡∏µ‡∏ö‡∏£‡∏±‡∏î</span></label>
                </div>
            </div>
        </fieldset>
    </div>

    <div id="page3" class="tab-content">
        <div class="sect-title">üõ°Ô∏è ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á & ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥ (Risk & History)</div>
        
        <div class="grid-2">
            <fieldset>
                <legend>Braden Scale (‡πÅ‡∏ú‡∏•‡∏Å‡∏î‡∏ó‡∏±‡∏ö)</legend>
                <div class="row"><label>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏°:</label> <input type="number" id="braden_total" style="width:60px;"></div>
                <div class="check-group" style="margin-top:5px;">
                    <label class="check-item" style="background:#d4edda;"><input type="radio" name="braden_risk" value="Low"> <span>‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏ï‡πà‡∏≥ (16-23)</span></label>
                    <label class="check-item" style="background:#fff3cd;"><input type="radio" name="braden_risk" value="Mod"> <span>‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á (13-15)</span></label>
                    <label class="check-item" style="background:#f8d7da;"><input type="radio" name="braden_risk" value="High"> <span>‡∏™‡∏π‡∏á (‚â§12)</span></label>
                </div>
                <hr style="border-top:1px dashed #ddd; margin:10px 0;">
                <label>‡∏°‡∏µ‡πÅ‡∏ú‡∏•‡∏Å‡∏î‡∏ó‡∏±‡∏ö:</label>
                <div class="check-group">
                    <label class="check-item"><input type="radio" name="pu" value="No"> <span>‡πÑ‡∏°‡πà‡∏°‡∏µ</span></label>
                    <label class="check-item"><input type="radio" name="pu" value="Yes"> <span>‡∏°‡∏µ (‡∏£‡∏∞‡∏ö‡∏∏)</span></label>
                </div>
                <input type="text" id="pu_note" placeholder="‡∏£‡∏∞‡∏î‡∏±‡∏ö/‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á" style="width:100%; margin-top:5px;">
            </fieldset>

            <fieldset>
                <legend>Fall Risk (‡∏û‡∏•‡∏±‡∏î‡∏ï‡∏Å‡∏´‡∏Å‡∏•‡πâ‡∏°)</legend>
                <label>‡∏ú‡∏π‡πâ‡πÉ‡∏´‡∏ç‡πà (Adult):</label>
                <div class="check-group" style="margin-bottom:10px;">
                    <label class="check-item"><input type="radio" name="fall_a" value="0"> <span>0 (‡πÑ‡∏°‡πà‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á)</span></label>
                    <label class="check-item"><input type="radio" name="fall_a" value="Low"> <span>1-4 (‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á)</span></label>
                    <label class="check-item"><input type="radio" name="fall_a" value="High"> <span>‚â•5 (‡∏™‡∏π‡∏á)</span></label>
                </div>
                <label>‡πÄ‡∏î‡πá‡∏Å (Pediatric):</label>
                <div class="check-group">
                    <label class="check-item"><input type="radio" name="fall_p" value="Level1"> <span>0-6</span></label>
                    <label class="check-item"><input type="radio" name="fall_p" value="Level2"> <span>7-11</span></label>
                    <label class="check-item"><input type="radio" name="fall_p" value="Level3"> <span>12-23</span></label>
                </div>
            </fieldset>
        </div>

        <fieldset>
            <legend>‡∏Å‡∏¥‡∏à‡∏ß‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô (ADL)</legend>
            <table style="width:100%; text-align:center;">
                <tr style="background:#eee;">
                    <th style="text-align:left;">‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</th>
                    <th>‡∏ó‡∏≥‡πÑ‡∏î‡πâ‡πÄ‡∏≠‡∏á (0)</th>
                    <th>‡∏ó‡∏≥‡πÑ‡∏î‡πâ‡∏ö‡πâ‡∏≤‡∏á (1)</th>
                    <th>‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢ (2)</th>
                </tr>
                <tr>
                    <td style="text-align:left;">1. ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏ó‡∏≤‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£</td>
                    <td><input type="radio" name="adl_1" value="0"></td>
                    <td><input type="radio" name="adl_1" value="1"></td>
                    <td><input type="radio" name="adl_1" value="2"></td>
                </tr>
                <tr>
                    <td style="text-align:left;">2. ‡∏Å‡∏≤‡∏£‡∏Ç‡∏±‡∏ö‡∏ñ‡πà‡∏≤‡∏¢</td>
                    <td><input type="radio" name="adl_2" value="0"></td>
                    <td><input type="radio" name="adl_2" value="1"></td>
                    <td><input type="radio" name="adl_2" value="2"></td>
                </tr>
                <tr>
                    <td style="text-align:left;">3. ‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏¢‡πâ‡∏≤‡∏¢/‡πÄ‡∏î‡∏¥‡∏ô</td>
                    <td><input type="radio" name="adl_3" value="0"></td>
                    <td><input type="radio" name="adl_3" value="1"></td>
                    <td><input type="radio" name="adl_3" value="2"></td>
                </tr>
            </table>
        </fieldset>

        <fieldset>
            <legend>‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏™‡∏≤‡∏£‡πÄ‡∏™‡∏û‡∏ï‡∏¥‡∏î</legend>
            <div class="row">
                <label>‡∏™‡∏∏‡∏£‡∏≤:</label>
                <div class="check-group">
                    <label class="check-item"><input type="radio" name="alc" value="No"> <span>‡πÑ‡∏°‡πà‡∏î‡∏∑‡πà‡∏°</span></label>
                    <label class="check-item"><input type="radio" name="alc" value="Quit"> <span>‡πÄ‡∏•‡∏¥‡∏Å‡πÅ‡∏•‡πâ‡∏ß</span></label>
                    <label class="check-item"><input type="radio" name="alc" value="Yes"> <span>‡∏î‡∏∑‡πà‡∏°</span></label>
                </div>
            </div>
            <div class="row" style="margin-top:5px;">
                <label>‡∏ö‡∏∏‡∏´‡∏£‡∏µ‡πà:</label>
                <div class="check-group">
                    <label class="check-item"><input type="radio" name="smk" value="No"> <span>‡πÑ‡∏°‡πà‡∏™‡∏π‡∏ö</span></label>
                    <label class="check-item"><input type="radio" name="smk" value="Quit"> <span>‡πÄ‡∏•‡∏¥‡∏Å‡πÅ‡∏•‡πâ‡∏ß</span></label>
                    <label class="check-item"><input type="radio" name="smk" value="Yes"> <span>‡∏™‡∏π‡∏ö</span></label>
                </div>
            </div>
        </fieldset>
    </div>

    <div id="page4" class="tab-content">
        <div class="sect-title">üçé ‡πÇ‡∏†‡∏ä‡∏ô‡∏≤‡∏Å‡∏≤‡∏£ & ‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡∏ö‡πâ‡∏≤‡∏ô</div>
        
        <fieldset>
            <legend>Nutritional Risk (NRS 2002)</legend>
            <div class="row"><label>BMI:</label> <input type="text" id="bmi_val" style="width:80px;" readonly placeholder="Auto"></div>
            <div style="margin-top:10px;">
                <label>‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏Ñ‡∏±‡∏î‡∏Å‡∏£‡∏≠‡∏á (‡∏ï‡∏≠‡∏ö "‡πÉ‡∏ä‡πà" ‡∏Ç‡πâ‡∏≠‡πÉ‡∏î‡∏Ç‡πâ‡∏≠‡∏´‡∏ô‡∏∂‡πà‡∏á = ‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á):</label>
                <div style="display:flex; flex-direction:column; gap:8px; margin-top:5px;">
                    <label class="check-item"><input type="checkbox" id="nrs_1"> <span>1. BMI < 18.5 ‡∏´‡∏£‡∏∑‡∏≠ > 23</span></label>
                    <label class="check-item"><input type="checkbox" id="nrs_2"> <span>2. ‡∏ó‡∏≤‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏•‡∏î‡∏•‡∏á‡πÉ‡∏ô 1 ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå</span></label>
                    <label class="check-item"><input type="checkbox" id="nrs_3"> <span>3. ‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏•‡∏î‡πÉ‡∏ô 3 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</span></label>
                    <label class="check-item"><input type="checkbox" id="nrs_4"> <span>4. ‡∏õ‡πà‡∏ß‡∏¢‡∏´‡∏ô‡∏±‡∏Å/‡∏ß‡∏¥‡∏Å‡∏§‡∏ï</span></label>
                </div>
            </div>
        </fieldset>

        <fieldset>
            <legend>‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢ (Discharge Planning)</legend>
            <div class="grid-2">
                <div>
                    <label>‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢/‡∏ç‡∏≤‡∏ï‡∏¥:</label>
                    <div class="check-group" style="flex-direction:column; align-items:flex-start;">
                        <label class="check-item"><input type="checkbox" id="dc_plan"> <span>‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏Å‡∏©‡∏≤</span></label>
                        <label class="check-item"><input type="checkbox" id="dc_cost"> <span>‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢/‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå</span></label>
                        <label class="check-item"><input type="checkbox" id="dc_time"> <span>‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏û‡∏±‡∏Å‡∏ü‡∏∑‡πâ‡∏ô</span></label>
                    </div>
                </div>
                <div>
                    <label>‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢:</label>
                    <div class="check-group" style="flex-direction:column; align-items:flex-start;">
                        <label class="check-item"><input type="radio" name="dc_type" value="Home"> <span>‡∏Å‡∏•‡∏±‡∏ö‡∏ö‡πâ‡∏≤‡∏ô (‡∏õ‡∏Å‡∏ï‡∏¥)</span></label>
                        <label class="check-item"><input type="radio" name="dc_type" value="HomeHC"> <span>‡∏Å‡∏•‡∏±‡∏ö‡∏ö‡πâ‡∏≤‡∏ô (‡∏î‡∏π‡πÅ‡∏•‡∏ï‡πà‡∏≠‡πÉ‡∏Å‡∏•‡πâ‡∏ö‡πâ‡∏≤‡∏ô)</span></label>
                        <label class="check-item"><input type="radio" name="dc_type" value="Refer"> <span>Refer ‡πÑ‡∏õ ‡∏£‡∏û.‡∏≠‡∏∑‡πà‡∏ô</span></label>
                    </div>
                </div>
            </div>
            <div style="margin-top:15px;">
                <label>‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏´‡∏•‡∏±‡∏Å:</label>
                <input type="text" id="caregiver" placeholder="‡∏ä‡∏∑‡πà‡∏≠ / ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå / ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£" style="width:100%;">
            </div>
        </fieldset>

        <div style="margin-top:30px; border-top:1px solid #ccc; padding-top:20px;">
            <div class="grid-2">
                <div>
                    <label>‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏ú‡∏π‡πâ‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô:</label>
                    <input type="text" id="rn_sign" style="width:100%;">
                </div>
                <div>
                    <label>‡∏ß‡∏±‡∏ô-‡πÄ‡∏ß‡∏•‡∏≤‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å:</label>
                    <input type="datetime-local" id="rec_time" style="width:100%;">
                </div>
            </div>
        </div>
    </div>

    <div class="action-bar" data-html2canvas-ignore="true">
        <button class="btn back-btn" onclick="window.location.href='patient_list.html'">‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</button>
        <button class="btn btn-del" onclick="deleteData()">‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
        <button class="btn btn-save" onclick="saveData()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
        <button class="btn btn-pdf" onclick="generatePDF()">‡∏≠‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô PDF</button>
    </div>

</div>

<script>
    // --- ON LOAD: Connect to Patient System ---
    window.onload = function() {
        // 1. ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤ (patient_list.html)
        const patientProfile = JSON.parse(localStorage.getItem('patientProfile'));
        if (patientProfile) {
            // ‡πÅ‡∏¢‡∏Å‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• (‡∏™‡∏°‡∏°‡∏ï‡∏¥‡∏ß‡πà‡∏≤ name ‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏õ‡πá‡∏ô "‡∏ä‡∏∑‡πà‡∏≠ ‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•")
            const nameParts = patientProfile.name.split(' ');
            document.getElementById('pt_name').value = nameParts[0] || '';
            document.getElementById('pt_surname').value = nameParts.slice(1).join(' ') || '';
            document.getElementById('pt_hn').value = patientProfile.hn || '';
            document.getElementById('pt_an').value = patientProfile.an || '';
            
            // ‡∏•‡∏≠‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤‡∏Ç‡∏≠‡∏á AN ‡∏ô‡∏µ‡πâ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
            searchData(true); // true = silent mode (‡πÑ‡∏°‡πà‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÄ‡∏à‡∏≠)
        }

        // 2. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
        const now = new Date();
        now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
        document.getElementById('rec_time').value = now.toISOString().slice(0,16);
    }

    // --- AUTO CALCULATE BMI ---
    function calculateBMI() {
        const weight = parseFloat(document.getElementById('vs_bw').value);
        const height = parseFloat(document.getElementById('vs_ht').value);
        const bmiField = document.getElementById('bmi_val');

        if (weight > 0 && height > 0) {
            // ‡∏™‡∏π‡∏ï‡∏£: ‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å (kg) / ‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏π‡∏á (m)^2
            const heightInMeters = height / 100;
            const bmi = weight / (heightInMeters * heightInMeters);
            bmiField.value = bmi.toFixed(2); // ‡∏ó‡∏®‡∏ô‡∏¥‡∏¢‡∏° 2 ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á
        } else {
            bmiField.value = '';
        }
    }

    // --- TABS LOGIC ---
    function openTab(tabName) {
        let tabs = document.getElementsByClassName("tab-content");
        for(let t of tabs) t.classList.remove("active");
        
        let btns = document.getElementsByClassName("tab-btn");
        for(let b of btns) b.classList.remove("active");
        
        document.getElementById(tabName).classList.add("active");
        event.currentTarget.classList.add("active");
    }

    // --- DATA HANDLING ---
    function getAllInputs() {
        return document.querySelectorAll('input, select, textarea');
    }

    function saveData() {
        const an = document.getElementById('pt_an').value.trim();
        if(!an) return Swal.fire('‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏•‡∏Ç AN ‡∏Å‡πà‡∏≠‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å', 'warning');

        let data = {};
        getAllInputs().forEach(el => {
            if(el.type === 'radio') {
                if(el.checked) data[el.name] = el.value;
            } else if(el.type === 'checkbox') {
                data[el.id] = el.checked;
            } else {
                if(el.id) data[el.id] = el.value;
            }
        });

        localStorage.setItem('RN_Form_' + an, JSON.stringify(data));
        Swal.fire('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß', 'success');
    }

    function searchData(silent = false) {
        const an = document.getElementById('pt_an').value.trim();
        if(!an && !silent) return Swal.fire('‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô', '‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏•‡∏Ç AN ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤', 'warning');
        if(!an && silent) return;

        const raw = localStorage.getItem('RN_Form_' + an);
        if(!raw) {
            if(!silent) Swal.fire('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏Ç‡∏≠‡∏á AN ‡∏ô‡∏µ‡πâ', 'info');
            return;
        }

        const data = JSON.parse(raw);
        getAllInputs().forEach(el => {
            if(el.type === 'radio') {
                if(data[el.name] == el.value) el.checked = true;
            } else if(el.type === 'checkbox') {
                if(data[el.id]) el.checked = true;
            } else {
                if(data[el.id] !== undefined) el.value = data[el.id];
            }
        });
        
        // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì BMI ‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏™‡∏£‡πá‡∏à
        calculateBMI();

        if(!silent) Swal.fire('‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', 'success');
    }

    function deleteData() {
        const an = document.getElementById('pt_an').value.trim();
        if(!an) return;
        
        Swal.fire({
            title: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö?',
            text: `‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• AN: ${an} ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?`,
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#d33',
            confirmButtonText: '‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•'
        }).then((result) => {
            if(result.isConfirmed) {
                localStorage.removeItem('RN_Form_' + an);
                location.reload();
            }
        });
    }

    function generatePDF() {
        const element = document.getElementById('form-container');
        const an = document.getElementById('pt_an').value || 'Unknow';
        
        // Show all tabs for PDF
        let tabs = document.getElementsByClassName("tab-content");
        for(let t of tabs) t.style.display = "block";

        const opt = {
            margin: [5, 5, 5, 5],
            filename: `Nurse_Assess_${an}.pdf`,
            image: { type: 'jpeg', quality: 0.98 },
            html2canvas: { scale: 2 },
            jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
        };

        html2pdf().set(opt).from(element).save().then(() => {
            // Revert tabs
            for(let t of tabs) t.style.display = "none";
            document.getElementById('page1').style.display = "block";
        });
    }
</script>

</body>
</html>
